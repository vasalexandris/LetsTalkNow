<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TalkEase â€“ Live Translator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="container">
    <section id="left" class="panel">
      <header>
        <h2>Speak</h2>
        <button id="micBtn" style="background:#00c6ff;color:#000;font-weight:bold;padding:8px 16px;border:none;border-radius:4px;">Hold & Talk</button>
      </header>
      <textarea id="sourceText" placeholder="Your speech will appear hereâ€¦" readonly></textarea>
    </section>

    <section id="right" class="panel">
      <header>
        <h2>Translation</h2>
        <select id="langSelect">
          <option value="el">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</option>
          <option value="en">English</option>
          <option value="es">EspaÃ±ol</option>
          <option value="fr">FranÃ§ais</option>
          <option value="de">Deutsch</option>
        </select>
      </header>
      <textarea id="translatedText" placeholder="Translation will appear hereâ€¦" readonly></textarea>
    </section>
<h2>test</h2>
    
  </div>

  <!-- Î•Î½Î¹Î±Î¯Î¿ inline script Ï€Î¿Ï… Ï€Î¬Î½Ï„Î± Ï†Î¿ÏÏ„ÏŽÎ½ÎµÎ¹ -->
  <script>
    (function () {
      const btn = document.getElementById('micBtn');
      const src = document.getElementById('sourceText');
      const dst = document.getElementById('translatedText');
      const sel = document.getElementById('langSelect');

      // Browser support check
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert('Î¤Î¿ browser ÏƒÎ¿Ï… Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î±Î½Î±Î³Î½ÏŽÏÎ¹ÏƒÎ· Î¿Î¼Î¹Î»Î¯Î±Ï‚.');
        return;
      }

      const rec = new SpeechRecognition();
      rec.continuous = true;
      rec.interimResults = true;
      rec.lang = 'en-US';          // Î´Î¿ÎºÎ¹Î¼Î¬Î¶Î¿Ï…Î¼Îµ Î‘Î³Î³Î»Î¹ÎºÎ¬
rec.interimResults = false;  // Î²Î»Î­Ï€Î¿Ï…Î¼Îµ Î¼ÏŒÎ½Î¿ Ï„Î¿ Ï„ÎµÎ»Î¹ÎºÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿

      // Events
      rec.onstart = () => btn.textContent = 'ðŸ”´ listeningâ€¦';
      rec.onend   = () => btn.textContent = 'ðŸŽ¤ Hold & Talk';
      rec.onresult = (e) => {
        const txt = e.results[e.results.length - 1][0].transcript;
        src.value = txt;

        // Î´Ï‰ÏÎµÎ¬Î½ Î¼ÎµÏ„Î¬Ï†ÏÎ±ÏƒÎ· Google
        const url = 'https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=' +
                    sel.value + '&dt=t&q=' + encodeURIComponent(txt);
        fetch(url)
          .then(r => r.json())
          .then(d => dst.value = d[0]?.map(t => t[0]).join('') || '')
          .catch(() => dst.value = 'Î£Ï†Î¬Î»Î¼Î± Î¼ÎµÏ„Î¬Ï†ÏÎ±ÏƒÎ·Ï‚');
      };

      // Hold button
      btn.addEventListener('mousedown', () => {
        navigator.mediaDevices.getUserMedia({ audio: true })
          .then(() => rec.start())
          .catch(() => alert('Î”ÏŽÏƒÏ„Îµ Î¬Î´ÎµÎ¹Î± Î³Î¹Î± Î¼Î¹ÎºÏÏŒÏ†Ï‰Î½Î¿'));
      });

      btn.addEventListener('mouseup', () => rec.stop());
      btn.addEventListener('touchstart', (e) => { e.preventDefault(); btn.dispatchEvent(new Event('mousedown')); });
      btn.addEventListener('touchend',   (e) => { e.preventDefault(); btn.dispatchEvent(new Event('mouseup')); });
    })();
  </script>
  
</body>
</html>
